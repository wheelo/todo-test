---
config:
  layout: dagre
  theme: default
  look: classic
---
flowchart TD
    A["ğŸš€ <b>æ‰©å±•å…¥å£å±‚</b><br>Extension Entry<br>src/extension.ts"] --> B["åˆ›å»ºClineProvider"] & C["æ³¨å†Œå‘½ä»¤å’Œä»£ç æ“ä½œ"] & D["è®¾ç½®å›½é™…åŒ–"] & E["åˆå§‹åŒ–ç»ˆç«¯æ³¨å†Œè¡¨"] & F["æ³¨å†Œå·®å¼‚è§†å›¾æä¾›è€…"]
    B --> G["âš™ï¸ <b>æ ¸å¿ƒæ§åˆ¶å±‚</b><br>ClineProvider<br>src/core/webview/ClineProvider.ts"]
    G --> H["ç®¡ç†Webviewè§†å›¾"] & I["å¤„ç†UIæ¶ˆæ¯"] & J["ç»´æŠ¤Clineå®ä¾‹æ ˆ"] & K["åè°ƒä»»åŠ¡æ‰§è¡Œ"] & TT["ä¸Šä¸‹æ–‡ä»£ç†<br>ContextProxy<br>src/core/context/ContextProxy.ts"] & UU["å·¥ä½œåŒºè·Ÿè¸ªå™¨<br>WorkspaceTracker<br>src/core/workspace/WorkspaceTracker.ts"] & L["ğŸ–¥ï¸ <b>ç”¨æˆ·ç•Œé¢å±‚</b><br>Webview UI<br>webview-ui/src/App.tsx"]
    I --> SS["ğŸ“¨ <b>UIæ¶ˆæ¯å¤„ç†å±‚</b><br>webviewMessageHandler<br>src/core/webview/webviewMessageHandler.ts"]
    L --> M["èŠå¤©è§†å›¾ç»„ä»¶<br>ChatView<br>webview-ui/src/components/ChatView/ChatView.tsx"] & N["å†å²è§†å›¾ç»„ä»¶<br>HistoryView<br>webview-ui/src/components/HistoryView/HistoryView.tsx"] & O["è®¾ç½®è§†å›¾ç»„ä»¶<br>SettingsView<br>webview-ui/src/components/SettingsView/SettingsView.tsx"] & P["å¸‚åœºè§†å›¾ç»„ä»¶<br>MarketplaceView<br>webview-ui/src/components/MarketplaceView/MarketplaceView.tsx"]
    M --> Q["èŠå¤©æ–‡æœ¬åŒºåŸŸ<br>ChatTextArea<br>webview-ui/src/components/ChatView/ChatTextArea.tsx"] & R["èŠå¤©è¡Œç»„ä»¶<br>ChatRow<br>webview-ui/src/components/ChatView/ChatRow.tsx"]
    J --> S["ğŸ”§ <b>ä»»åŠ¡å¼•æ“å±‚</b><br>Task Engine<br>src/core/task/Task.ts#L124"]
    S --> T["ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†"] & U["å¤„ç†ç”¨æˆ·è¾“å…¥"] & V["å‘é€APIè¯·æ±‚"] & W["è°ƒç”¨å·¥å…·"] & X["ç®¡ç†ä»»åŠ¡çŠ¶æ€"] & VV["æ–‡ä»¶ä¸Šä¸‹æ–‡è·Ÿè¸ªå™¨<br>FileContextTracker<br>src/core/task/FileContextTracker.ts"] & WW["å·¥å…·é‡å¤æ£€æµ‹å™¨<br>ToolRepetitionDetector<br>src/core/tools/ToolRepetitionDetector.ts"]
    W --> Y["ğŸ› ï¸ <b>å·¥å…·ç³»ç»Ÿå±‚</b><br>Tools System<br>src/core/tools/"]
    Y --> Z["æ–‡ä»¶è¯»å–å·¥å…·<br>readFileTool<br>src/core/tools/readFileTool.ts"] & AA["æ–‡ä»¶å†™å…¥å·¥å…·<br>writeToFileTool<br>src/core/tools/writeToFileTool.ts"] & BB["å‘½ä»¤æ‰§è¡Œå·¥å…·<br>executeCommandTool<br>src/core/tools/executeCommandTool.ts"] & CC["ä»£ç åº“æœç´¢å·¥å…·<br>codebaseSearchTool<br>src/core/tools/codebaseSearchTool.ts"] & DD["å·®å¼‚åº”ç”¨å·¥å…·<br>applyDiffTool<br>src/core/tools/applyDiffTool.ts"] & EE["å†…å®¹æ’å…¥å·¥å…·<br>insertContentTool<br>src/core/tools/insertContentTool.ts"] & FF["æœç´¢æ›¿æ¢å·¥å…·<br>searchAndReplaceTool<br>src/core/tools/searchAndReplaceTool.ts"] & GG["æ–‡ä»¶åˆ—è¡¨å·¥å…·<br>listFilesTool<br>src/core/tools/listFilesTool.ts"] & GITDIFF["ğŸ“‹ <b>Git Diffç³»ç»Ÿ</b><br>Git Diff System"]
    GITDIFF --> DIFF1["å·®å¼‚æ£€æµ‹<br>Diff Detection<br>src/core/diff/"] & DIFF2["å˜æ›´è¿½è¸ª<br>Change Tracking"] & DIFF3["æ–‡ä»¶æ¯”è¾ƒ<br>File Comparison"]
    CC --> YY["ğŸ” <b>ä»£ç åº“ç´¢å¼•ç³»ç»Ÿ</b><br>Codebase Index System"]
    YY --> LAYER1["<b>ç®¡ç†å±‚</b><br>Management Layer"] & LAYER2["<b>å¤„ç†å±‚</b><br>Processing Layer"] & LAYER3["<b>å­˜å‚¨å±‚</b><br>Storage Layer"]
    LAYER1 --> ZZ["ç´¢å¼•ç®¡ç†å™¨<br>CodeIndexManager<br>src/core/codebase-index/manager.ts"] & AAA["é…ç½®ç®¡ç†å™¨<br>CodeIndexConfigManager<br>src/core/codebase-index/config.ts"] & BBB["çŠ¶æ€ç®¡ç†å™¨<br>CodeIndexStateManager<br>src/core/codebase-index/state.ts"]
    LAYER2 --> CCC["æœåŠ¡å·¥å‚<br>CodeIndexServiceFactory<br>src/core/codebase-index/service-factory.ts"] & DDD["ç¼–æ’å™¨<br>CodeIndexOrchestrator<br>src/core/codebase-index/orchestrator.ts"] & EEE["ç›®å½•æ‰«æå™¨<br>DirectoryScanner<br>src/core/codebase-index/scanner.ts"] & FFF["æ–‡ä»¶ç›‘å¬å™¨<br>FileWatcher<br>src/core/codebase-index/file-watcher.ts"] & GGG["ä»£ç è§£æå™¨<br>CodeParser<br>src/core/codebase-index/parser.ts"] & HHH["Tree-sitterè§£æ<br>src/core/codebase-index/tree-sitter/index.ts"]
    LAYER3 --> III["å‘é‡å­˜å‚¨<br>VectorStore<br>src/core/codebase-index/vector-store/"] & JJJ["ç¼“å­˜ç®¡ç†å™¨<br>CacheManager<br>src/core/codebase-index/cache.ts"]
    V --> HH["ğŸŒ <b>APIå¤„ç†å±‚</b><br>API Handler<br>src/api/"]
    HH --> II["APIå¤„ç†æ¥å£<br>ApiHandleræ¥å£<br>src/api/index.ts"] & JJ["APIæä¾›å•†<br>API Providers<br>src/api/providers/"]
    JJ --> KK["Anthropicæä¾›å•†<br>anthropic.ts<br>src/api/providers/anthropic.ts"] & LL["OpenAIæä¾›å•†<br>openai.ts<br>src/api/providers/openai.ts"] & NN["å…¶ä»–æä¾›å•†<br>src/api/providers/"]
    X --> OO["ğŸ’¾ <b>æŒä¹…åŒ–å±‚</b><br>Persistence Layer"]
    OO --> LOCAL["<b>æŒä¹…åŒ–</b><br>src/core/task-persistence/"]
    LOCAL --> PP["ä»»åŠ¡æ¶ˆæ¯å­˜å‚¨<br>taskMessages.ts<br>src/core/task-persistence/taskMessages.ts"] & QQ["APIæ¶ˆæ¯å­˜å‚¨<br>apiMessages.ts<br>src/core/task-persistence/apiMessages.ts"] & RR["ä»»åŠ¡å…ƒæ•°æ®å­˜å‚¨<br>taskMetadata.ts<br>src/core/task-persistence/taskMetadata.ts"] & CACHE["æœ¬åœ°ç¼“å­˜<br>Local Cache"] & FILES["æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨<br>File System Storage"]
    Q -. ç”¨æˆ·è¾“å…¥ .-> SS
    SS -. è½¬å‘æ¶ˆæ¯ .-> S
    S -. APIè¯·æ±‚ .-> HH
    HH -. å“åº” .-> S
    S -. æ›´æ–°çŠ¶æ€ .-> G
    G -. UIæ›´æ–° .-> M
    S -. é€‰æ‹©å·¥å…· .-> Y
    Y -. æ‰§è¡Œæ“ä½œ .-> XX["æ–‡ä»¶ç³»ç»Ÿ/å‘½ä»¤è¡Œ"]
    XX -. ç»“æœè¿”å› .-> S
    S -. æœ¬åœ°æŒä¹…åŒ– .-> LOCAL
    CC -. ç´¢å¼•æœç´¢ .-> YY
    YY -. æœç´¢ç»“æœ .-> CC
    DD -. å·®å¼‚æ£€æµ‹ .-> GITDIFF
    GITDIFF -. å·®å¼‚ç»“æœ .-> DD
    Y -. çŠ¶æ€åŒæ­¥ .-> SHADOWGIT["ğŸ‘¥ <b>Shadow Gitç³»ç»Ÿ</b><br>Shadow Git System"]
    SHADOWGIT -. è™šæ‹ŸçŠ¶æ€ .-> Y
     A:::entryPoint
     G:::controller
     TT:::controller
     UU:::controller
     L:::ui
     SS:::controller
     M:::ui
     N:::ui
     O:::ui
     P:::ui
     Q:::ui
     R:::ui
     S:::engine
     VV:::engine
     WW:::engine
     Y:::tools
     Z:::tools
     AA:::tools
     BB:::tools
     CC:::tools
     DD:::tools
     EE:::tools
     FF:::tools
     GG:::tools
     GITDIFF:::gitSystem
     DIFF1:::gitSystem
     DIFF2:::gitSystem
     DIFF3:::gitSystem
     YY:::codebaseIndex
     LAYER1:::codebaseIndex
     LAYER2:::codebaseIndex
     LAYER3:::codebaseIndex
     ZZ:::codebaseIndex
     AAA:::codebaseIndex
     BBB:::codebaseIndex
     CCC:::codebaseIndex
     DDD:::codebaseIndex
     EEE:::codebaseIndex
     FFF:::codebaseIndex
     GGG:::codebaseIndex
     HHH:::codebaseIndex
     III:::codebaseIndex
     JJJ:::codebaseIndex
     HH:::api
     II:::api
     JJ:::api
     KK:::api
     LL:::api
     NN:::api
     OO:::persistence
     LOCAL:::localPersistence
     PP:::localPersistence
     QQ:::localPersistence
     RR:::localPersistence
     CACHE:::localPersistence
     FILES:::localPersistence
     SHADOWGIT:::shadowSystem
    classDef entryPoint fill:#e1f5fe,stroke:#01579b,stroke-width:3px,color:#000
    classDef controller fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    classDef ui fill:#e8f5e8,stroke:#1b5e20,stroke-width:3px,color:#000
    classDef engine fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000
    classDef tools fill:#fce4ec,stroke:#880e4f,stroke-width:3px,color:#000
    classDef gitSystem fill:#fff3e0,stroke:#ff6f00,stroke-width:3px,color:#000
    classDef shadowSystem fill:#f1f8e9,stroke:#558b2f,stroke-width:3px,color:#000
    classDef codebaseIndex fill:#e3f2fd,stroke:#0d47a1,stroke-width:3px,color:#000
    classDef api fill:#f1f8e9,stroke:#33691e,stroke-width:3px,color:#000
    classDef persistence fill:#fff8e1,stroke:#f57f17,stroke-width:3px,color:#000
    classDef localPersistence fill:#e8f5e8,stroke:#2e7d32,stroke-width:3px,color:#000
    classDef cloudPersistence fill:#e3f2fd,stroke:#1565c0,stroke-width:3px,color:#000
